# 单调栈

## 基本介绍

给定一个 n 个数的数组和一个空栈，依次读取 n 个数，每个数分别入栈一次，出栈一次，最后仍然是空栈。

在这个过程中，需要保持栈里面的元素 **从栈顶到栈底一直是单调递增（或递减）** 的，相应的，按照出栈顺序排列的 n 个数也是单调递增（或递减）的。

n 个数的入栈顺序是原数组顺序，但是出栈顺序就不一定了，这个算法就是用来控制，何时入栈，何时出栈。

## 经典题目

### 题目一：双侧最近较小元素

给定一个数组，求数组中每个位置的 **左边最近的小于它的元素，和右边最近的小于它的元素**。

本题可分为两个子题：

- 数组中无重复元素
- 数组中有重复元素

例如：`arr=[3,4,2,6,1,7,0]`，第一个元素 `3` 左边最近的小于它的元素没有，右边最近的小于它的元素为 `2`。

> 本题就是在考察单调栈的实现。

### 题目二：子数组的最大指标

给定一个只包含正数的数组 arr，arr 中任何一个子数组 sub，一定都可以算出一个指标：`(sub累加和)*(sub中的最小值)` 是什么，那么所有子数组中，这个值最大是多少？

#### 解决方法

使用单调栈，对每一个位置讨论，求 **以数组中每一个位置为最小值** 的子数组的最大指标是多少，最后一起取最大值即可。而以数组中某一个位置为最小值的子数组的最大指标的范围可以使用单调栈，即左边最近比他小的元素，到右边最近比他小的元素这个范围限定。

### 题目三：直方图最大面积

> https://leetcode.cn/problems/largest-rectangle-in-histogram/

给定一个非负数组 arr，代表直方图，返回直方图最大长方形面积。

### 题目四：最大子矩形

> https://leetcode.com/problems/maximal-rectangle/

给定一个二维数组 matrix，其中的值不是 0 就是 1，返回全部由 1 组成的最大子矩形，内部有多少个 1。

#### 解决方法

数组压缩 + 题目三解法。假设：

```
输入二维数组：
[
	[1, 1, 1, 1, 1],
	[1, 0, 1, 1, 1],
	[1, 1, 1, 0, 1],
	[1, 1, 1, 1, 1]
]
```

先进行数组压缩：

```
 -- 以第 0 行的数组做地基：[1, 1, 1, 1, 1]，求直方图最大面积
 -- 以第 1 行的数组做地基：[2, 0, 2, 2, 2]，求直方图最大面积
 -- 以第 2 行的数组做地基：[3, 1, 3, 0, 3]，求直方图最大面积
 -- 以第 3 行的数组做地基：[4, 2, 4, 1, 4]，求直方图最大面积
```

最后求他们中的最大值即可。时间复杂度：$O(N^2)$ ，单调栈处理为 $O(N)$ ，遍历 $N$ 行。

### 题目五：子数组最小值的累加和

> https://leetcode.cn/problems/sum-of-subarray-minimums/

给定一个数组arr，返回所有子数组最小值的累加和。

如：`arr=[3,1,4,2]`，所有子数组的最小值：

```
0-0 : 3
0-1 : 1
0-2 : 1
0-3 : 1
1-1 : 1
1-2 : 1
1-3 : 1
2-2 : 4
2-3 : 2
3-3 : 2
```

返回 `3+1+1+1+1+1+1+4+2+2 = 17`

















